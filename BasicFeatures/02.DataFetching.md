# [Written by 심재철](https://github.com/simsimjae)

![](../.gitbook/assets/simsimjae.png)

```text
아래 문서는 Next.js 9.3 이상 버전에서 적용됩니다.
```

# Data Fetching

여기서는 Static Generation과 SSR에서의 Data Fetching 방법에 대해서 살펴보겠다.

Pre rendering시 사용할 수 있는 3가지 함수가 있다.

1. getStaticProps (빌드타임)
2. getStatcPaths (빌드타임)
3. getServerSideProps (요청타임)

# getStaticProps(Static Generation)

```js
export async function getStaticProps(context) {
  const { params, preview, previewData } = context;

  return {
    props: {}, // (필수) 페이지 컴포넌트의 props로 전달됨. serializable object여야한다.
    revalidate: // (선택) 몇 초 뒤에 페이지를 재생성할건지
  };
}
```

페이지 컴포넌트에서 이런 함수를 export해주면 빌드 타임에 HTML을 생성해준다.
이때 매개변수로 전달된 `context`에는 다음값들이 들어있다.

- `params` - 페이지의 라우팅과 관련된 값들이 들어있다. 만약 파일명이 `[id].js`고 라우팅이 `/1` 인 경우 params에는 `{ id: 1 }`이 들어있게된다.
- `preview` - 페이지가 preview모드인 경우 true다.
- `previewData` - `setPreviewData`함수에 의해 설정된 preview data를 포함한다.

{% hint style="info" %}
getStaticProps는 클라이언트에서는 사용되지 않는다. 그래서 서버에서 사용되는 코드를 이 함수에 적어줄 수 있고 파일시스템이나 데이터베이스에도 접근할 수 있다.
{% endhint %}

# 간단한 예제

블로그를 만들때 `getStaticProps`를 활용할 수 있다.

```js
// 4. posts는 빌드 타임에 전달된 외부 데이터다.
function Blog({ posts }) {
  return (
    <ul>
      {posts.map((post) => (
        <li>{post.title}</li>
      ))}
    </ul>
  );
}

// 1. 빌드타임에 실행됨
export async function getStaticProps() {
  // 블로그 글을 불러오기 위해 API를 호출한다.
  const res = await fetch("https://.../posts");
  const posts = await res.json();

  // Blog Page Component에 받아온 데이터를 전달한다.
  return {
    props: {
      posts,
    },
  };
}

export default Blog;
```

## 언제 getStaticProps를 사용해야 하나요?

- 페이지를 빌드 타임에 미리 생성해도 괜찮은 경우 (꼭 유저의 요청이 없어도 미리 데이터를 구해올 수 있을때)
- Headless CMS로 부터 데이터를 가져올 때
- 데이터가 캐싱되어도 상관 없을 때
- 페이지가 매우 빠르게 렌더링 되어야 할때

**`getStaticProps`는 HTML과 JSON을 생성하기 때문에 CDN에 의해 캐싱되어 매우 빠릅니다.**

## 타입스크립트에서 getStaticProps 사용하기

```ts
import { GetStaticProps } from "next";

export const getStaticProps: GetStaticProps = async (context) => {
  // ...
};
```

`GetStaticProps` Type을 사용하면 된다.
만약 getStaticProps에서 리턴하는 Props의 타입을 추론해서 사용할 경우 `InferGetStaticPropsType`를 사용하라.

```ts
import { InferGetStaticPropsType } from "next";

// 5. 페이지 컴포넌트에서 받은 posts의 타입을 추론
function Blog({ posts }: InferGetStaticPropsType<typeof getStaticProps>) {
  // will resolve posts to type Post[]
}

type Post = {
  author: string;
  content: string;
};

// 1. 빌드타임에 실행
export const getStaticProps = async () => {
  // 2. Data Fetch
  const res = await fetch("https://.../posts");
  // 3. 받아온 데이터의 타입을 지정(Post[])
  const posts: Post[] = await res.json();

  return {
    props: {
      posts, // 4. 페이지 컴포넌트로 전달.
    },
  };
};

export default Blog;
```

```ts
import { InferGetStaticPropsType } from "next";
InferGetStaticPropsType<typeof getStaticProps>
```

이것을 사용하면 getStaticProps 함수가 리턴하는 값의 타입을 추론할 수 있다.
